Esta es la recapitulaci√≥n integral y definitiva de todos los archivos y tareas necesarios para implementar la funcionalidad "Delete Account", utilizando el flujo avanzado de Hard Delete At√≥mico con Conciliaci√≥n Previa para administradores y Soft Delete para usuarios est√°ndar.‚öôÔ∏è Fase 0: Prerrequisitos de Base de Datos (Integridad)#Archivo / ComponenteTarea Conceptual0.1SQL Migration (user_accounts tabla)A√±adir la columna de Soft Delete: deleted_at TIMESTAMPTZ DEFAULT NULL.0.2SQL Migration (transactions y Tablas Espec√≠ficas)Modificar Claves For√°neas (FKs): Aplicar la cl√°usula ON DELETE CASCADE a las FKs que referencian user_accounts (ej: source_account_id, destination_account_id).üíª Fase 1: Backend - Reporte de Impacto y Conciliaci√≥n (GET)Esta fase crea el servicio que informa al usuario sobre el Monto de Ajuste Neto necesario para conciliar la cuenta.#Archivo / ComponenteTarea Conceptual1.1backend/src/fintrack_api/services/reconciliationService.js (Nuevo)L√≥gica de Impacto: Funci√≥n para ejecutar la consulta SQL compleja que calcula el Monto de Ajuste Neto de cada cuenta activa que interactu√≥ con la cuenta a borrar.1.2backend/src/fintrack_api/controllers/reconciliationController.js (Nuevo)Controlador GET: Recibe el accountId y llama a reconciliationService. Devuelve el array de cuentas afectadas y sus ajustes.1.3backend/src/routes/accountRoutes.js (Modificar)Definir Ruta GET: A√±adir la ruta para obtener el reporte de impacto: router.get('/reconciliation-impact/:accountId', verifyUser, reconciliationController);.üí° Fase 2: Frontend - Tipos y Rutas#Archivo / ComponenteTarea Conceptual2.1frontend/src/types/responseApiTypes.ts (Modificar)Definir Tipo: Declarar el tipo ReconciliationImpactType para la respuesta del backend, incluyendo el campo clave net_adjustment_amount.2.2frontend/src/endpoints.ts (Modificar)Definir URLs: A√±adir la URL para el reporte de impacto (url_get_reconciliation_impact) y la URL de eliminaci√≥n (url_delete_account).2.3frontend/src/types/types.ts (Opcional)Verificaci√≥n de Rol: Asegurar que UserRolesType ('user' | 'admin' | 'super_admin') est√© definido para la l√≥gica de visualizaci√≥n en la UI.üõ°Ô∏è Fase 3: Backend - L√≥gica de Eliminaci√≥n At√≥mica (DELETE)Esta es la l√≥gica de negocio central que ejecuta la liquidaci√≥n y el borrado de forma segura.#Archivo / ComponenteTarea Conceptual3.1backend/src/routes/accountRoutes.js (Modificar)Definir Ruta DELETE: Asegurar la ruta router.delete('/:accountId', verifyUser, deleteAccountController);.3.2backend/src/routes/index.js (Modificar)Integraci√≥n: Importar y montar accountRoutes en el router principal: router.use('/account', accountRoutes);.3.3backend/src/fintrack_api/controllers/accountDeleteController.js (Modificar)Controlador DELETE: Implementar la l√≥gica condicional: Validar userRole si deletionType === 'HARD' (403 Forbidden si no es Admin). Llamar al servicio adecuado.3.4backend/src/fintrack_api/services/accountService.js (Modificar)L√≥gica de Soft Delete: Implementar el UPDATE de deleted_at.3.5backend/src/fintrack_api/services/accountService.js (Modificar)L√≥gica de Hard Delete AT√ìMICA: Para Hard Delete, el c√≥digo debe envolver dos pasos en una √∫nica transacci√≥n de DB: 1. INSERT de las transacciones de ajuste (liquidaci√≥n). 2. DELETE de user_accounts (activa el CASCADE).üñ•Ô∏è Fase 4: Frontend - Experiencia de Usuario y Flujo (UX)Esta fase implementa la navegaci√≥n y el modal de doble verificaci√≥n.#Archivo / ComponenteTarea Conceptual4.1frontend/src/stores/useAccountStore.ts (Modificar)Store Action: Crear la acci√≥n removeAccount(accountId) para eliminar la cuenta del estado global de la aplicaci√≥n.4.2frontend/src/components/AccountActionsMenu.tsx (Modificar)Navegaci√≥n: Configurar el bot√≥n "Delete Account" para navegar a la nueva p√°gina de borrado, pasando el accountId (ej: /forms/delete/:accountId).4.3frontend/src/pages/forms/deleteAccount/DeleteAccount.tsx (Nuevo)P√°gina de Control: L√≥gica principal. Al cargar, usa useFetch para llamar a la API de Impacto (Fase 1). Gestionar la visualizaci√≥n del Modal de Conciliaci√≥n.4.4frontend/src/general_components/modals/ConfirmDeleteModal.tsx (Modificar/Nuevo)Modal de Conciliaci√≥n: Crear un modal avanzado que: 1. Muestre la tabla con el net_adjustment_amount. 2. Muestre opciones de Soft/Hard Delete (Hard solo visible para Admin, basado en userRole). 3. Al confirmar el Hard Delete, env√≠a el net_adjustment_amount (o los datos de impacto) en el cuerpo de la solicitud DELETE a la API (Fase 3).4.5frontend/src/hooks/useFetchLoad.ts (Integraci√≥n)Ejecuci√≥n Final: Utilizar este hook para realizar la solicitud DELETE final. Si es exitosa (c√≥digo 202), llamar a useAccountStore.removeAccount y redirigir al usuario.